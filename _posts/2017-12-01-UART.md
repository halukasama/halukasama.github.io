---
layout:     post
title:      "Linux串口通信"
subtitle:   "Linux UART1"
date:       2017-09-25 12:00:00
author:     "Wjl"
header-img: "img/post_jcptrebuild.jpg"
catalog: true
tags:
    - c/c++
    - 二次开发
    - Linux
---

> 拿到同事的模块demo，发现有些东西,不会也不了解，串口通信简单入个门吧

先去翻一下ietftools, 关于rs232的介绍看的云里雾里
然后检索中文，发现大部分人都是基于[这里](参考1)寻求解决方案

开始机翻搬运：

## 串口引脚说明
> 工作接触的都是利用CH340T等类似芯片实现了UART转USB，所以不需要太过关注 

RS-232-C的9针引脚定义：  

|序号|信号名称|符号|流向|功能|  
|--|--|--|--|--|  
|1|载波检测|DCD|DTE←DCE|表示 DCE 接收到远程载波|
|2|接收数据|RXD|DTE←DCE|DTE接收串行数据|
|3|发送数据|TXD|DTE→DCE|DTE发送串行数据|
|4|数据终端就绪|DTR|DTE→DCE|DTE 准备好|
|5|公共地|GND||信号公共地|
|6|数据设备就绪|DSR|DTE←DCE|DCE 准备好|
|7|请求发送|RTS|DTE→DCE|DTE 请求 DCE 将线路切换到发送方式|
|8|允许发送|CTS|DTE←DCE|DCE 告诉 DTE 线路已接通可以发送数据|
|9|振铃指示|RI|DTE←DCE|表示 DCE 与线路接通，出现振铃|  

1. **GND - 逻辑地**
- 从技术上讲，逻辑地不是一个信号，但没有它的信号将不会运作。 基本上，逻辑地作为参考电压，以便电子器件知道哪些电压是正的还是负的。

2. **TXD - 传输数据**
- TXD信号承载从工作站传输到另一端计算机或设备（如MODEM）的数据。 标记电压被解释为值1，而空间电压被解释为值0。

3. **RXD - 接收到的数据**
- RXD信号将从另一端计算机或设备传输的数据传输到工作站。 像TXD一样，标记和空间电压分别被解释为1和0。

4. **DCD - 数据载体检测**
- 从串行电缆另一端的计算机或设备接收DCD信号。 此信号线上的空间电压表示计算机或设备当前已连接或联机。 DCD并不总是被使用或可用。

5. **CTS - 清除发送**
- CTS信号从串行电缆的另一端收到。 空间电压表示可以从工作站发送更多串行数据。
CTS通常用于管理从工作站到另一端的串行数据流。

6. **RTS - 请求发送**
- 您的工作站将RTS信号设置为空间电压，以指示可以发送更多数据。
和CTS一样，RTS有助于调节工作站与串行电缆另一端的计算机或设备之间的数据流。 大多数工作站始终将此信号设置为空间电压。

## 异步通信
- 为了让计算机了解进入它的串行数据，它需要一些方法来确定一个字符结束和下一个开始的位置。 
- 在异步模式下，串行数据线保持标记（1）状态，直到发送字符。 一个起始位在每个字符前面，紧接着是字符中的每个位，一个可选的奇偶校验位以及一个或多个停止位。 起始位总是一个空格（0），并告诉计算机新的串行数据可用。 数据可以随时发送或接收，因此名称是异步的。

- 可选奇偶校验位是数据位的简单总和，指示数据是否包含偶数或奇数个1位。如果偶数奇偶校验，则在字符中偶数个1的情况下，奇偶校验位为0。使用奇数奇偶校验时，如果数据中有奇数个1，则奇偶校验位为0。您也可能听到条款空间平价，标记平价和不平价。空间奇偶校验意味着奇偶校验位始终为0，而​​标记奇偶校验表示该位始终为1.没有奇偶校验意味着没有奇偶校验位存在或发送。

- 其余的位称为停止位。在字符之间可以有1个，1.5个或2个停止位，并且它们总是具有1的值。传统上，停止位用于使计算机有时间处理前一个字符，但现在仅用于将接收计算机同步到输入字符。

- 异步数据格式通常表示为“8N1”，“7E1”等等。这些分别代表“8个数据位，无奇偶校验，1个停止位”和“7个数据位，偶校验，1个停止位”。

## 同步通信

- 与异步数据不同，同步数据显示为恒定的比特流。要读取线上的数据，计算机必须提供或接收一个公共位时钟，以便发送者和接收者都同步。

- 即使进行这种同步，计算机也必须以某种方式标记数据的开始。这样做的最常见方式是使用数据包协议，如串行数据链路控制（“SDLC”）或高速数据链路控制（“HDLC”）。

- 每个协议都定义了某些位序列来表示数据包的开始和结束。每个还定义了在没有数据时使用的比特序列。这些位序列允许计算机看到数据包的开始。

- 因为同步协议不使用每字符同步位，所以它们通常比异步通信提供至少25％的性能改进，并且适用于具有两个以上串行接口的远程网络和配置。

- 尽管同步通信具有速度优势，但由于需要额外的硬件和软件，大多数RS-232硬件不支持它。

## 什么是全双工和半双工？

- 全双工意味着计算机可以同时发送和接收数据 - 有两个独立的数据通道（一个进入，一个出去）。

- 半双工意味着计算机无法同时发送或接收数据。通常这意味着只有一个数据通道可以通话。这并不意味着没有使用任何RS-232信号。相反，它通常意味着通信链路使用一些不支持全双工操作的RS-232以外的标准。

## 流量控制

- 在两个串行接口之间传输数据时，通常需要调节数据流。这可能是由于中间串行通信链路，串行接口之一或某些存储介质的限制。两种方法通常用于异步数据。

- 第一种方法通常称为“软件”流量控制，并使用特殊字符启动（XON或DC1，021八进制）或停止（XOFF或DC3，023八进制）数据流。这些字符在美国信息交换标准代码（“ASCII”）中定义。虽然这些代码在传输文本信息时非常有用，但在传输其他类型的信息时无法使用，无需特殊编程。

- 第二种方法称为“硬件”流量控制，使用RS-232 CTS和RTS信号代替特殊字符。当接收器准备好接收更多数据时，将CTS设置为空间电压，并在未准备好时将其设置为标记电压。同样，当发送器准备发送更多数据时，发送器将RTS设置为空间电压。由于硬件流量控制使用单独的一组信号，因此它比需要发送或接收多位信息以完成同样任务的软件流控制要快得多。所有硬件或操作系统都不支持CTS / RTS流量控制。

## 什么是休息（what's a break）？

- 通常接收或发送数据信号保持在标记电压，直到传输新字符。如果信号长时间下降到空间电压，通常是1/4到1/2秒，则说明存在断开状态。

- 中断有时用于重置通信线路或改变通信硬件的操作模式，如MODEM。第3章，与MODEM交谈，更深入地介绍了这些应用。

### 访问串行端口

- 像所有设备一样，UNIX通过设备文件提供对串行端口的访问。要访问串行端口，只需打开相应的设备文件即可。

## 串行端口文件

UNIX系统上的每个串行端口都有一个或多个与其关联的设备文件（/ dev目录中的文件）：  

 串行端口设备文件  

|System|Port1|Port2|
|------|-----|-----|
|IRIX® |/dev/ttyf1|/dev/tty2|
|HP-UX |/dev/tty1p0|/dev/tty2p0|
|Solaris®/SunOS®|/dev/ttya|dev/ttyb|
|Linux®|/dev/ttyS0|/dev/ttyS1|
|Digital UNIX®|/dev/tty01|/dev/tty02|

在对应的系统上，操作对应的文件即可完成串口通信。  